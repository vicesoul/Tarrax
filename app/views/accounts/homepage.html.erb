<% content_for :head do %>
<style type="text/css" media="all">
#wrapper #main {
  max-width: none;
  margin-bottom: 0;
}
#wrapper #main #content{
  padding: 0;
}
#wrapper-container{
  margin-top: 0 !important;
}
</style>
<% end unless @can_manage_homepage %>

<% content_for :page_title do %><%= "#{t(:home_page, "Homepage")} | #{@account.name}"%><% end %>

<% jammit_css :tinymce, :account_homepage %>
<% js_bundle  :account_homepage %>

<%= render :partial => 'jxb/pages/content', :locals => { :page => @page, :partial_name => 'accounts/homepage_content' } %>

<% if @can_manage_homepage %>
<div id="fixed_right_sider">
  <div>
    <a href="javascript:void(0)" class="edit_theme_link btn button-sidebar-wide"><i class="icon-edit"></i> <%= t(:edit_this_page, "Edit this page") %></a>
    <%= hidden_field_tag 'hidden_update_theme_url', account_page_update_theme_path(@account, @page, '') %>
    <% form_for @page, :url => account_page_path(@account, @page) do |f| %>
    <div id="theme_options_holder">
      <div id="theme_options">
        <%= before_label(:name, 'Theme name') %>
        <%= f.select :theme, Jxb::Theme.themes %>
        <%= f.hidden_field :background_image %>
        <%= before_label(:add_new_widget, 'New widget') %>
        <%= select "widget", "name", Jxb::Widget.types %> <%= link_to image_tag('/images/add.png'), 'javascript:void(0)', :id => 'add_widget', :class => 'add_widget_icon', :title => t('tip.drag_add_widget', 'Dragging me to the area you want to edit') %> <%= image_tag '/images/blue_small_loading.gif', :class => 'add_widget_loading_icon', :style => 'display:none;' %>
        <%= link_to t(:assign_courses, 'Assign courses'), 'javascript:void(0)', :id => 'link_to_choose_courses_dialog' %><br />
        <%= link_to t(:change_background, 'Change background'), 'javascript:void(0)', :id => 'link_to_change_background_dialog' %><br />
        <%= link_to t(:reset_homepage, 'Reset homepage'), account_reset_homepage_path, :id => 'reset_homepage' %>
      </div><!-- End of div#theme_options -->
      <%= hidden_field_tag :widget_url, new_account_page_widget_path(@account, @page) %>
      <div class="button-container rs-margin-lr">
        <button type="submit" class="save_theme_button btn btn-primary"><%= t(:save, "Save") %></button>
        <button class="btn cancel"><%= t(:cancel, "Cancel") %></button>
      </div>
    </div><!-- End of div#theme_options_holder -->
    <% end # End of form_for %>
  </div>
</div>
<div id="edit_widget_dialog">
  <div class="edit_widget_section">
    <div id="edit-widget-dialog-title">
      <%= t :title, 'Title' %>: <input type="text" name="widget_title" id="widget_title" value="" /><br />
    </div>
    <%= t :body, 'Body' %>: <textarea name="widget_body" id="widget_body" style="width:100%;"></textarea><br />
    <form id="widget_image_uploader" action="<%= account_files_path(@account) %>" method="POST" enctype="multipart/form-data">
        <%= t :choose_image, "Choose image"%>: <%= file_field_tag "attachment[uploaded_data]", :id => "widget_image" %> 
        <!-- <input type="submit" value="<%= t :upload, 'Upload'%>" /> -->
    </form>
    <br />
    <button type="submit" class="save_widget_button btn btn-primary"><%= t :save, 'Save' %></button>
    <button class="btn" onclick="$('#edit_widget_dialog').dialog('close');return false;"><%= t :cancel, 'Cancel' %></button>
  </div>
</div>
<div id="choose_courses_dialog" title="<%= t(:assign_courses, "Assign courses") %>">
  <% courses_with_account = @account.all_courses.inject(Hash.new{|h,k| h[k] = []}){|h,course| h[course.root_account.name] << course; h } %>
  <% cached_courses = @page.courses || [] %>
  <ul>
  <% courses_with_account.each do |account_name, courses| %>
    <li>
      <%= check_box_tag 'course_name', account_name, false, :class => 'account_name_checkbox' %> <%= account_name %>
      <ul class="all_sub_checkboxs">
      <% courses.each do |course| %>
        <li><%= check_box_tag "jxb_page[courses][]", course.id, cached_courses.include?(course.id.to_s), :id => "jxb_page_courses_#{course.id}" %> <%= course.name %></li>
      <% end %>
      </ul>
    </li>
  <% end %>
  </ul>
  <a href="javascript:void(0)" class="save_choose_courses_link btn btn-primary button-sidebar-wide"><%= t(:save, "Save") %></a>
</div>
<div id="change_background_dialog" title="<%= t(:change_background, 'Change background') %>">
  <%= t :background_color, 'Background color' %>: <input type="text" name="page_background_color" id="page_background_color" value="<%= @backgroud_data[:color] %>" /><br /><br />
  <form id="background_image_uploader" action="<%= account_files_path(@account) %>" method="POST" enctype="multipart/form-data">
    <span id="background_image_holder"><%=raw @backgroud_data[:image] %></span><%= t :choose_image, "Choose image"%>: <%= file_field_tag "attachment[uploaded_data]", :id => "background_bg_image" %> 
  </form>
  <br />
  <a href="javascript:void(0);" id="delete_background_image"><%= t :delete_background_image, 'Delete background image' %></a><br />
  <%= t :repeat, 'Repeat' %> <%= check_box_tag 'repeat', '1', @backgroud_data[:repeat] %><br /><br />
  <button type="submit" class="save_background_button btn btn-primary"><%= t :save, 'Save' %></button>
  <button class="btn" onclick="$('#change_background_dialog').dialog('close');return false;"><%= t :cancel, 'Cancel' %></button>
</div>

<div id="add_widget_dialog" style="display:none">
  <%= before_label(:add_new_widget, 'New widget') %>
  <%= select "widget", "name", Jxb::Widget.types %> <%= link_to image_tag('/images/add.png'), 'javascript:void(0)', :id => 'add_widget', :class => 'add_widget_icon' %> <%= image_tag '/images/blue_small_loading.gif', :class => 'add_widget_loading_icon', :style => 'display:none;' %>
</div>

<% end %>
